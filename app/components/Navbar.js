// app/components/Navbar.js
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import { useCart } from '../context/CartContext';
import styles from './Navbar.module.css';

export default function Navbar() {
    const { getCartItemsCount, setIsCartOpen } = useCart();
    const [isScrolled, setIsScrolled] = useState(false);
    const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);

    // Détecter le scroll pour changer l'apparence de la navbar
    useEffect(() => {
        const handleScroll = () => {
            setIsScrolled(window.scrollY > 10);
        };

        window.addEventListener('scroll', handleScroll);
        return () => window.removeEventListener('scroll', handleScroll);
    }, []);

    const cartCount = getCartItemsCount();

    return (
        <nav className={`${styles.navbar} ${isScrolled ? styles.scrolled : ''}`}>
            <div className={styles.container}>
                <div className={styles.navbarContent}>

                    <Link href="/" className={styles.logo}>
                        <svg width="139" height="53" viewBox="0 0 139 53" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M96.2584 37.8742C95.4802 37.8742 94.702 37.636 94.1033 37.1L86.5009 30.9068C85.6029 30.1922 85.124 29.0011 85.2438 27.8697L86.5009 17.4483C86.6206 16.3169 87.2791 15.3641 88.2967 14.8281L94.5224 11.6124L94.7618 12.0888L88.5362 15.3045C87.6981 15.7214 87.0995 16.5551 86.9798 17.5079L85.7226 27.9292C85.6029 28.9416 86.022 29.8944 86.7403 30.4899L94.3428 36.6832C95.3006 37.4573 96.6176 37.5764 97.6352 36.9214L107.393 31.3236C108.111 30.9068 108.59 30.2517 108.77 29.4775L110.565 21.736C110.745 20.8427 110.565 19.8899 109.907 19.1753L101.885 10.0641L102.304 9.70674L110.326 18.818C111.044 19.6517 111.344 20.7832 111.104 21.8551L109.308 29.5966C109.069 30.4899 108.53 31.3236 107.692 31.8L97.9345 37.3978C97.3958 37.6955 96.7971 37.8742 96.1985 37.8742H96.2584Z" fill="#F0ABE0" />
                            <path d="M102.843 34.3011C102.245 32.7528 101.945 30.1921 101.945 26.5H102.484C102.484 30.1326 102.783 32.6337 103.382 34.0629L102.903 34.2416L102.843 34.3011Z" fill="black" />
                            <path d="M89.5538 32.9314H89.0151C89.0151 32.9314 89.0151 30.0135 89.494 26.3214C89.913 22.927 90.8109 18.1034 92.6667 14.4708C94.5822 10.7786 96.438 8.75393 97.6951 7.74157C99.0719 6.61011 100.209 6.19327 100.628 6.19327C101.047 6.19327 100.868 6.25281 100.988 6.37191C101.347 6.72922 101.826 7.86069 102.245 9.2899C102.664 10.9573 102.903 12.6843 102.903 14.2326C102.903 15.0663 102.843 16.3169 102.723 17.8056C102.723 18.4607 102.664 19.1753 102.604 19.9494H102.065C102.065 19.1753 102.125 18.4607 102.185 17.8056C102.245 16.3764 102.304 15.1258 102.364 14.2921C102.364 12.1483 101.945 10.2427 101.646 9.2899C101.167 7.68204 100.748 6.96741 100.568 6.84831C100.329 6.84831 99.3712 7.14608 97.9944 8.27754C96.7971 9.2899 94.9414 11.2551 93.0857 14.8876C91.2898 18.4011 90.3919 23.1652 89.9729 26.5596C89.494 30.1922 89.494 33.0506 89.494 33.1101L89.5538 32.9314Z" fill="black" />
                            <path d="M101.586 26.7382C99.6107 26.7382 97.9944 25.1303 97.9944 23.1652C97.9944 21.2 99.6107 19.5921 101.586 19.5921C103.562 19.5921 105.178 21.2 105.178 23.1652C105.178 25.1303 103.562 26.7382 101.586 26.7382ZM101.586 20.1877C99.91 20.1877 98.5331 21.5573 98.5331 23.2247C98.5331 24.8921 99.91 26.2618 101.586 26.2618C103.262 26.2618 104.639 24.8921 104.639 23.2247C104.639 21.5573 103.262 20.1877 101.586 20.1877Z" fill="black" />
                            <path d="M104.579 24.7731C103.681 24.5348 102.723 24.3562 101.706 24.2371C100.568 24.0584 99.3712 23.9393 98.2937 23.8202V23.2843C99.4909 23.3438 100.628 23.5225 101.826 23.7011C102.783 23.8798 103.801 24.0584 104.699 24.2966L104.579 24.8326V24.7731Z" fill="black" />
                            <path d="M90.0926 24.0584C89.0749 23.582 88.4763 22.5697 88.4763 21.4382C88.4763 19.8303 89.7933 18.5202 91.4095 18.5202V19.0562C90.0926 19.0562 89.0151 20.1281 89.0151 21.4382C89.0151 22.7483 89.5538 23.1652 90.332 23.582L90.0926 24.0584Z" fill="black" />
                            <path d="M90.5116 22.1528C89.913 22.0933 89.3144 22.0337 88.7157 21.9742V21.4382C89.3742 21.4382 89.9729 21.5573 90.5715 21.6168V22.1528H90.5116Z" fill="black" />
                            <path d="M103.681 22.6888C103.979 22.6888 104.22 22.4488 104.22 22.1528C104.22 21.8568 103.979 21.6169 103.681 21.6169C103.384 21.6169 103.143 21.8568 103.143 22.1528C103.143 22.4488 103.384 22.6888 103.681 22.6888Z" fill="black" />
                            <path d="M89.913 20.2472C90.2105 20.2472 90.4517 20.0073 90.4517 19.7113C90.4517 19.4153 90.2105 19.1753 89.913 19.1753C89.6154 19.1753 89.3742 19.4153 89.3742 19.7113C89.3742 20.0073 89.6154 20.2472 89.913 20.2472Z" fill="black" />
                            <path d="M92.7864 28.4652C92.6068 28.4652 92.3673 28.4652 92.1878 28.4056C91.8286 28.3461 91.5891 28.1674 91.5891 27.9292C90.9307 28.1079 90.7511 27.9888 90.6313 27.9292C90.4518 27.8101 90.332 27.6315 90.332 27.3933C90.332 26.5596 90.7511 25.9641 91.5891 25.7259C92.4272 25.4877 93.4449 25.3686 93.9836 26.2618C94.5224 27.1551 94.3428 27.691 94.1632 27.9292C93.9238 28.2865 93.4449 28.4652 92.8462 28.4652H92.7864ZM92.068 27.8101C92.068 27.8101 92.1877 27.8101 92.2476 27.8697C92.8462 27.9888 93.4449 27.8697 93.6245 27.5719C93.804 27.3337 93.7442 26.9169 93.4449 26.5C93.1455 26.0236 92.6068 25.9641 91.649 26.2023C91.0504 26.3809 90.8109 26.7382 90.8109 27.3933C90.8109 28.0483 90.8109 27.4528 90.8109 27.4528C90.8109 27.4528 91.1102 27.5719 92.1279 27.0955C92.1279 27.0955 92.1279 27.0955 92.1878 27.0955C92.4871 26.9169 92.8462 26.7382 92.8462 26.7382C92.966 26.7382 93.1455 26.7382 93.2054 26.8573C93.2653 26.9764 93.2054 27.1551 93.0857 27.2146C92.8462 27.3933 92.6068 27.5124 92.3673 27.6315C92.1878 27.7506 92.068 27.8697 92.0082 27.9292L92.068 27.8101Z" fill="black" />
                            <path d="M94.7618 27.9888C94.7618 27.9888 94.6421 27.9888 94.5823 27.9888C94.1034 27.8697 93.804 27.3337 93.804 27.2741C93.7442 27.155 93.804 26.9764 93.9238 26.9169C94.0435 26.8573 94.2231 26.9169 94.2829 27.036C94.3428 27.1551 94.5224 27.4528 94.702 27.4528C94.702 27.4528 94.8217 27.4528 94.8816 27.3933C95.0013 27.3337 95.121 27.2146 94.9414 26.8573C94.8217 26.5596 94.5224 26.2023 94.2231 25.845C94.0435 25.6068 93.8639 25.5472 93.5646 25.5472C93.1456 25.5472 92.7864 25.845 92.6667 25.9641C92.6068 26.0832 92.4272 26.1427 92.3075 26.0236C92.1878 25.964 92.1279 25.7854 92.2476 25.6663C92.4871 25.3686 93.0258 25.0112 93.5646 25.0112C93.9836 25.0112 94.3428 25.1899 94.6421 25.4876C94.9414 25.9045 95.2407 26.3213 95.4203 26.6786C95.6598 27.2741 95.4203 27.6315 95.1809 27.8101C95.0013 27.9292 94.8217 27.9888 94.702 27.9888H94.7618Z" fill="black" />
                            <path d="M103.562 7.92022C103.442 7.92022 103.382 7.92025 103.322 7.80115C102.005 5.59777 99.7903 4.64494 99.7903 4.64494C99.6705 4.64494 99.6107 4.46628 99.6107 4.34718L100.03 0.238217C100.03 0.119116 100.149 0.0595506 100.269 0C100.389 0 100.509 7.26758e-06 100.568 0.119108L101.885 2.67978L106.076 0.0595724C106.196 2.18072e-05 106.315 0.0595724 106.375 0.0595724C106.435 0.0595724 106.495 0.238224 106.435 0.357325L104.579 4.64494L108.59 5.71688C108.71 5.71688 108.77 5.83595 108.77 5.95506C108.77 6.07416 108.71 6.19327 108.59 6.19327L103.621 7.80115C103.621 7.80115 103.621 7.80115 103.562 7.80115V7.92022ZM100.209 4.22811C100.748 4.46631 102.484 5.41909 103.681 7.32471L107.632 6.01463L104.16 5.0618C104.1 5.0618 104.04 5.00224 103.981 4.94269C103.981 4.88314 103.981 4.82361 103.981 4.70451L105.657 0.952831L101.945 3.27528C101.885 3.27528 101.826 3.27528 101.706 3.27528C101.646 3.27528 101.586 3.21572 101.526 3.15617L100.449 1.13148L100.149 4.16854L100.209 4.22811Z" fill="#F0ABE0" />
                            <path d="M0 11.136H12.6309C19.994 11.136 23.5857 13.8157 23.5857 20.9618C23.5857 28.1079 20.2334 31.2045 13.5288 31.2045H9.87726V36.5641H0V11.1955V11.136ZM12.3316 24.4753C13.7683 24.4753 14.2472 23.7011 14.2472 22.5101V20.7832C14.2472 19.473 13.7683 18.9371 12.3316 18.9371H9.93711V24.4753H12.3316Z" fill="black" />
                            <path d="M35.199 11.136V36.5045H25.5013V11.136H35.199Z" fill="black" />
                            <path d="M60.5805 23.1056V36.5045H54.0555L52.6189 34.0034H52.4393C51.4815 36.0281 49.8652 36.8618 47.2911 36.8618C40.826 36.8618 37.4139 32.6337 37.4139 24.2966C37.4139 15.9595 41.7838 10.7787 52.6787 10.7787C63.5736 10.7787 58.7847 11.0169 60.1615 11.2551V19.3539L60.0418 19.473C58.5452 19.3539 56.5099 19.2348 54.3549 19.2348C52.1998 19.2348 49.9849 19.4731 48.9074 20.009C47.77 20.6045 47.351 21.9742 47.351 23.6416V24.7731C47.351 26.5 47.7101 27.8697 48.5482 28.3461C49.1468 28.7034 50.1046 28.882 51.3617 28.882C52.6189 28.882 52.0202 28.882 52.3794 28.8225V23.1652H60.5207L60.5805 23.1056Z" fill="black" />
                            <path d="M82.9091 29.418V36.5045H62.975V11.136H82.8493V18.2225H72.8523V20.9618H81.5922V26.5H72.8523V29.418H82.9091Z" fill="black" />
                            <path d="M112.84 11.136H123.137L126.908 16.8528C127.267 17.5079 128.943 20.664 130.26 23.2247H130.559C130.021 20.2472 129.302 16.1382 129.302 15.6023V11.136H139V36.5045H129.063L125.112 30.3708C124.753 29.7753 123.496 27.5124 122.239 25.4281H121.999C122.239 26.9764 122.658 30.1922 122.658 31.0259V36.445H112.96V11.0764L112.84 11.136Z" fill="black" />
                            <path d="M64.711 49.1292V52.8809H62.975V43.7697H67.0456C69.081 43.7697 70.2183 44.8416 70.2183 46.2708C70.2183 47.7 69.5 48.1764 68.7218 48.4146C69.3204 48.5933 69.9789 49.0697 69.9789 50.6776V51.0944C69.9789 51.6899 69.9789 52.464 70.0986 52.8809H68.3626C68.183 52.464 68.183 51.809 68.183 50.8562V50.6776C68.183 49.6056 67.8837 49.0697 66.2674 49.0697H64.711V49.1292ZM64.711 47.7596H66.5667C67.8238 47.7596 68.3027 47.2832 68.3027 46.4494C68.3027 45.6157 67.764 45.1989 66.6266 45.1989H64.711V47.7596Z" fill="black" />
                            <path d="M89.1348 48.2955C89.1348 50.7967 87.5784 53 84.4655 53C81.3527 53 79.916 50.9158 79.916 48.2955C79.916 45.6753 81.5921 43.591 84.5853 43.591C87.5784 43.591 89.0749 45.4966 89.0749 48.236L89.1348 48.2955ZM81.8316 48.2955C81.8316 50.1416 82.7295 51.6303 84.5853 51.6303C86.441 51.6303 87.2791 50.082 87.2791 48.3551C87.2791 46.6281 86.441 45.0798 84.5254 45.0798C82.6098 45.0798 81.8316 46.509 81.8316 48.2955Z" fill="black" />
                            <path d="M101.107 52.8809V49.6056C101.107 49.4865 101.107 49.427 101.047 49.3079L97.6951 43.7101H99.7304C100.509 45.1393 101.646 47.1045 102.065 48.0573C102.484 47.1641 103.681 45.0798 104.46 43.7101H106.375L102.963 49.2483C102.963 49.3079 102.903 49.3674 102.903 49.5461V52.8214H101.107V52.8809Z" fill="black" />
                            <path d="M116.192 50.5584L115.354 52.8809H113.559L116.851 43.7697H119.126L122.598 52.8809H120.682L119.784 50.5584H116.192ZM119.425 49.1292C118.647 47.0449 118.228 45.7944 117.988 45.0203C117.749 45.854 117.27 47.3427 116.612 49.1292H119.425Z" fill="black" />
                            <path d="M132.236 43.7697H134.031V51.4517H138.88L138.641 52.8809H132.176V43.7697H132.236Z" fill="black" />
                        </svg>
                    </Link>

                    <div className={`${styles.menuLinks} ${isMobileMenuOpen ? styles.active : ''}`}>
                        <Link href="/" className={styles.navLink}>Accueil</Link>
                        <Link href="/products" className={styles.navLink}>Produits</Link>
                        <Link href="/about" className={styles.navLink}>À propos</Link>
                        <Link href="/contact" className={styles.navLink}>Contact</Link>
                    </div>

                    <div className={styles.navActions}>
                        <button className={styles.searchButton} aria-label="Rechercher">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                <circle cx="11" cy="11" r="8"></circle>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                            </svg>
                        </button>

                        <button
                            onClick={() => setIsCartOpen(true)}
                            className={styles.cartButton}
                            aria-label={`Ouvrir le panier, ${cartCount} articles`}
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                                <line x1="3" y1="6" x2="21" y2="6"></line>
                                <path d="M16 10a4 4 0 0 1-8 0"></path>
                            </svg>
                            {cartCount > 0 && <span className={styles.badge}>{cartCount}</span>}
                        </button>

                        <button
                            className={styles.mobileMenuButton}
                            onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
                            aria-label="Menu"
                        >
                            <span className={styles.hamburger}>
                                <span className={`${styles.hamburgerLine} ${isMobileMenuOpen ? styles.active : ''}`}></span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        </nav>
    );
}